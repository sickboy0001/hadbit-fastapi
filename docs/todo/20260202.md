## 要件について- テンプレートはhadbit_itemの付随情報とする
  - テンプレート利用して入力されたログは「 -」への付随情報とする。コメントかられたものは -.commentに落ちる

以下の※１、※２を検討してもらうことはできるでしょうか？
※１はitem_styleを使うため新設のテーブルは不要な想定です。

※２のテーブルデザイン、
※１，※２の登録サンプルなどもらえるでしょうか？

### アイコンと色付け
- 各習慣マスタに対してＦｏｒｅカラーを指定できるｋと
- 各習慣マスタに対して、アイコンを指定できること
- それらの情報はＪＳＯＮＢとして保存すること
- 特定の種類を入力できるようにする。
  - 最終的にはCommentに落とすのがゴール
  - Commentに複数のコントロールから作成する
  - 以下などがデータとして登録されること
  - そのためのテンプレートとして、マスタに結び付けること
    - 「階段」：「感想３」
    - 「睡眠」：ｘｘ時間「感想４」
    - 「ウォーキング」のコメント：ｘｘ分（内ラン〇〇分）
    - 「体重計測」のコメント：ｘｘ.ｘkg「感想１」
    - 「ジムのコメント」：有酸素〇〇分ｘ△回（内ラン□□分ｘｘ.ｘk）「感想２」
  - 備考）
    - 項目：コメント
    - （「」はフリー入力スペース、ｘｘ、〇〇は数値、△は回数、それぞれに前置詞、後置詞をもつ）
  - テンプレートはhadbit_itemの付随情報とする
  - テンプレート利用して入力されたログは「hadbit_logs」への付随情報とする。コメントかられたものはhadbit_logs.commentに落ちる
  - 習慣項目マスタに付随する習慣項目マスタテンプレート（※１）で各項目に対しての付随情報のマスタを作成
  - 実施記録のコメントと、実施記録とは別テーブル（※２）のスペースに対象の情報を落とす

- 例１）
  - 「階段」というマスタに対して、テンプレートとして、フリー入力スペースをもつ
    - データとして入力されたときには、フリー入力された項目と、フリー入力された結果をもつ
  - 「睡眠」というマスタに対しては、テンプレートとして、数値入力スペース（ｘｘ時間のｘｘ）と、後置詞「時間をもつ」、フリー入力スペースももつ
    - データとして登録されたときには　数値入力スペース「１０」フリーコメント「良く寝れた」をデータとしてもち
    - コメントとして「１０時間「良く寝れた」」が落ちる


１．hadbit_items (習慣項目マスタ)
習慣項目の基本情報を保持します。user_id が UUID に変更されています。

カラム名	データ型	NULL許容	説明	備考
id	SERIAL	NO	項目の一意識別ID	主キー
user_id	UUID	NO	所有者ユーザーのID	外部キー (auth.users.id)
name	TEXT	NO	習慣の名前	
short_name	TEXT	YES	略称	
description	TEXT	YES	詳細説明	
parent_flag	BOOLEAN	YES	親カテゴリフラグ	デフォルト: false
public_flag	BOOLEAN	YES	公開設定	デフォルト: false
visible_flag	BOOLEAN	YES	表示有無	デフォルト: true
delete_flag	BOOLEAN	YES	削除フラグ	デフォルト: false
is_deleted	BOOLEAN	YES	削除状態（新設）	デフォルト: false
item_style	JSONB	YES	UIスタイル設定	JSON形式
updated_at	TIMESTAMP	NO	最終更新日時	既定値: CURRENT_TIMESTAMP
created_at	TIMESTAMP	NO	レコード作成日時	既定値: CURRENT_TIMESTAMP


1. hadbit_logs (実施記録)
ユーザーの習慣実施履歴です。user_id が UUID に更新されています。

カラム名	データ型	NULL許容	説明	備考
id	SERIAL	NO	記録の一意識別ID	主キー
user_id	UUID	NO	実施したユーザーのID	外部キー (auth.users.id)
item_id	INTEGER	NO	対象の項目ID	外部キー (hadbit_items.id)
done_at	TIMESTAMP	YES	実施日時	
comment	TEXT	YES	実施時のメモ	
updated_at	TIMESTAMP	NO	最終更新日時	既定値: CURRENT_TIMESTAMP
created_at	TIMESTAMP	NO	レコード作成日時	既定値: CURRENT_TIMESTAMP



### 画面・ログ登録・一覧
- 期間指定できるように、＜＜（前年）、＞＞（翌年）、今年
### 画面・ログ登録・ヒートマップ
- 期間指定できるように、＜＜（前年）、＞＞（翌年）、今年
- ツールチップで内訳確認可能、６件なら、６件の内容がツールチップで表示
- 日付をクリックすると、内訳が下の表（Table）に出ること
### 画面・ログ登録・日付カレンダー
- 期間指定できるように、＜＜（前年）、＞＞（翌年）、今年
- 対象日でのDoneのデータはｖで表示している、１件ならvでＯＫ、２件以上ならｖ２などの表現にすること。
### 画面・ログ登録・カレンダー
- 表示タイプ指定可能に４週間か、現行の２か月か。
- 表示タイプ２か月の時は表示期間指定できるように、＜＜（前月）、＞＞（翌月）、今月
- 表示タイプ４週間の時には＜＜（２週前）＞＞（２週あと）　今週　にする。
  



## 1. ※２のテーブルデザイン：hadbit_log_details

`hadbit_logs` に直接 JSONB を追加しても良いですが、要件にある「実施記録とは別テーブル」に基づき、ログの付随情報を詳細に保持するテーブルを定義します。

| カラム名 | データ型 | NULL許容 | 説明 | 備考 |
| --- | --- | --- | --- | --- |
| **id** | SERIAL | NO | 詳細レコードID | 主キー |
| **log_id** | INTEGER | NO | 親ログID | 外部キー (`hadbit_logs.id`) |
| **input_data** | JSONB | NO | 入力値の構造化データ | 各コントロールの値を保持 |
| **created_at** | TIMESTAMP | NO | 作成日時 | デフォルト: `CURRENT_TIMESTAMP` |

---

## 2. ※１，※２の登録サンプル（JSON構造）

各習慣の特性に合わせた `item_style`（テンプレート定義）と、それに基づき登録される `input_data`（実績詳細）の具体例です。
基本的にはインプットされたものがない（Empty）の時は、prefix suffixともに表示しない
〇10時間「」
〇10時間

### 例 A：睡眠

* **item_style (マスタ設定)**
```json
{
  "style": { "color": "#3f51b5", "icon": "bed" },
  "template": [
    { "id": "val1", "type": "number", "suffix": "時間" },
    { "id": "memo", "type": "text", "prefix": "「", "suffix": "」" }
  ]
}
```

* **input_data (ログ詳細)**
```json
{ "val1": 7, "memo": "すっきり目覚めた" }

```

* **hadbit_logs.comment (最終結果)**
`8時間「ぐっすり」`

### 例 B：ジム（複雑なケース）

* **item_style (マスタ設定)**
```json
{
  "style": { "color": "#ff5722", "icon": "dumbbell" },
  "template": [
    { "id": "cardio", "type": "number", "prefix": "有酸素", "suffix": "分" },
    { "id": "sets", "type": "number", "prefix": "ｘ", "suffix": "回" },
    { "id": "run_time", "type": "number", "prefix": "（内ラン", "suffix": "分" },
    { "id": "run_dist", "type": "number", "prefix": "ｘｘ.ｘ", "suffix": "k）" },
    { "id": "memo", "type": "text", "prefix": "「", "suffix": "」" }
  ]
}
```

* **input_data (ログ詳細)**
```json
{ "cardio": 30, "sets": 2, "run_time": 15, "run_dist": 2.5, "memo": "筋肉痛" }

```

* **hadbit_logs.comment (最終結果)**
`有酸素30分ｘ2回（内ラン15分2.5k）「筋肉痛」`

---

## 3. 実装のロジック・ポイント

1. **入力画面の動的生成**
フロントエンドで `item_style.template` をループさせ、`type` が `number` なら数値入力、`text` ならテキストエリアを生成します。
2. **Comment列の生成タイミング**
保存ボタンが押された際、フロントエンド側で `prefix + value + suffix` を全パーツ分結合して文字列を作り、`hadbit_logs.comment` に送信します。同時に、生データを `hadbit_log_details.input_data` に保存します。
3. **JSONBの利点**
「内ラン」がある時だけ項目を増やす、といった変更が `item_style` を書き換えるだけで完了し、DBのマイグレーションが不要になります。

# memo
データ取得するときに、標準時基準で見ているため、登録したものがすぐには見えれない状態です。
